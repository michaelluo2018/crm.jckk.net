{extend name="layout"/}
{block name="title"}
<title>工作台 - 客户管理系统</title>
{/block}
{block name="css"}
<style type="text/css">
    .cls_container{width:100%;height:24px;overflow:hidden;}
    .cls_container ul{list-style-type:none;margin:0;padding:0;margin-left:32px;}

    tr{border:  1px solid  #050}
    .fontb {color:white; background:blue;}
    .today{ background:green;}
    .today a{color:white;}
    th{width:50px;}
    td,th{height:50px;text-align:center;}
    form{margin:0px; padding:0px;}
    a{color: black;}
</style>
{/block}
{block name="breadcrumb"/}
<div class="col-md-5 col-8 align-self-center">
    <h3 class="text-themecolor">工作台</h3>
    <ol class="breadcrumb">
        <li class="breadcrumb-item"><a href="/">首页</a></li>
        <li class="breadcrumb-item active">工作台</li>
    </ol>
</div>
{/block}
{block name="detail"/}

<div style="background-color: white;margin-bottom: 20px;padding: 20px;">
    {include file="index/scroll_announcement"/}
</div>

<div class="row">
    <div class="col-lg-12">
        <div class="card">
            <div class="card-body">
                <h4 class="card-title">任务排期 <small style="margin-left: 185px;"><a href="{:url('index/task/task_add')}">添加新任务</a></small></h4>
                <!-- Nav tabs -->
                <div class="row">
                    <div class="col-xs-12 text-center">
                        {$res}
                    </div>
                    <div style="padding-left: 5px;">
                        <div id="task_content" >
                            {foreach name="tasks" item="task"/}
                            <div class="{$key} content_item" style="display: none">
                                {if condition="$task"/}
                                <table style="width: 200%;" >
                                    <thead>
                                    <tr class="text-align">
                                        <th>序号</th>
                                        <th>优先级</th>
                                        <th>任务名</th>
                                        <th>状态</th>
                                        <th>指派给</th>
                                        <th>创建人</th>
                                        <th>总预计</th>
                                        <th>总消耗</th>
                                        <th>总剩余</th>
                                        <th>时间进度</th>
                                        <th>操作</th>
                                    </tr>
                                    </thead>
                                    <tbody>
                                    {volist name="task" id="vo"}
                                    <tr>
                                        <td>{$key+1}</td>
                                        <td>{$vo.task_order}</td>
                                        <td>{$vo.task_name}</td>
                                        <td>
                                            {if condition="$vo.task_status eq 0"/}
                                            等待开始
                                            {elseif condition="$vo.task_status eq 1"/}
                                            已开始
                                            {elseif condition="$vo.task_status eq 2"/}
                                            完成
                                            {/if}
                                        </td>
                                        <td>{$vo.to_name}</td>
                                        <td>{$vo.create_name}</td>
                                        <?php if($vo['task_start'] && $vo['task_end']){ ?>
                                        <td>
                                            <?php
                          $num1=number_format(($vo['task_end']-$vo['task_start'])/86400,1);
                           echo $num1= $num1 >0 ?$num1 :0;
                                            ?>天
                                        </td>
                                        <td>
                                            <?php
                            $num2=number_format((time()-$vo['task_start'])/86400,1);
                            echo $num2 >0 ?$num2 :0;
                                            ?>天
                                        </td>
                                        <td>
                                            <?php
                            $num3 =number_format(($vo['task_end']-time())/86400,1);
                            echo   $num2 >0?$num3:$num1;
                                            ?>天
                                        </td>
                                        <td>
                                            <?php
                        $width = $num1 >0? number_format(($num2/$num1)*100,2):0;
                                            ?>
                                            <div class="progress">
                                                <div class="progress-bar" role="progressbar" style="width: <?php echo $width; ?>%;"></div><?php echo $width; ?>%
                                            </div>
                                        </td>
                                        <?php }else{?>
                                        <td></td>
                                        <td></td>
                                        <td></td>
                                        <td></td>
                                        <?php }?>
                                        <td> <a href="{:url('index/task/task_des')}?id={$vo.id}&mid={$mid}" class="btn btn-info">查看</a></td>
                                    </tr>
                                    {/volist}
                                    </tbody>
                                </table>
                                {else/}
                                <p>暂无任务</p>
                                {/if}
                            </div>
                            {/foreach}
                        </div>

                    </div>
                </div>
            </div>
        </div>
    </div>
</div>


{volist name="customer_status" id="status"/}
    <input type="hidden" name="{$status['key']}" value="{$status['value']}" class="{$status['field']}" id="{$status['key']}">
{/volist}


<div class="row">
    <!-- Column -->
    <div class="col-lg-6">
        <div class="card">
            <div class="card-body">
                <div id="visitor1" style="height:650px; width:100%;"></div>
            </div>
        </div>
    </div>

    <div class="col-lg-6">
        <div class="card">
            <div class="card-body">
                <div id="visitor2" style="height:650px; width:100%;"></div>
            </div>
        </div>
    </div>

    <div class="col-lg-6">
        <div class="card">
            <div class="card-body">
                <div id="visitor3" style="height:650px; width:100%;"></div>
            </div>
        </div>
    </div>

    <div class="col-lg-6">
        <div class="card">
            <div class="card-body">
                <div id="visitor4" style="height:650px; width:100%;"></div>
            </div>
        </div>
    </div>
    <div class="col-lg-6">
        <div class="card">
            <div class="card-body">
                <div id="visitor5" style="height:650px; width:100%;"></div>
            </div>
        </div>
    </div>
</div>

{include file="user/profile_common"/}

{/block}

{block name="footer_js"/}

<script type="text/javascript" src="http://echarts.baidu.com/gallery/vendors/echarts/echarts.min.js"></script>
<script type="text/javascript" src="http://echarts.baidu.com/gallery/vendors/echarts-gl/echarts-gl.min.js"></script>
<script type="text/javascript" src="http://echarts.baidu.com/gallery/vendors/echarts-stat/ecStat.min.js"></script>
<script type="text/javascript" src="http://echarts.baidu.com/gallery/vendors/echarts/extension/dataTool.min.js"></script>
<script type="text/javascript" src="http://echarts.baidu.com/gallery/vendors/echarts/map/js/china.js"></script>
<script type="text/javascript" src="http://echarts.baidu.com/gallery/vendors/echarts/map/js/world.js"></script>
<script type="text/javascript" src="http://api.map.baidu.com/api?v=2.0&ak=ZUONbpqGBsYGXNIYHicvbAbM"></script>
<script type="text/javascript" src="http://echarts.baidu.com/gallery/vendors/echarts/extension/bmap.min.js"></script>
<script type="text/javascript" src="http://echarts.baidu.com/gallery/vendors/simplex.js"></script>
<script src="__STATIC__/js/echart_data.js?t=2"></script>
<script>
    $('.show_task').click(function(){
        $('.today').removeClass('today');
        $(this).parents('td').addClass('today');
        var time = $(this).attr('id');
        $(".content_item").hide();
        $("."+time+"").show();
    });
</script>
{/block}